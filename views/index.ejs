<!DOCTYPE html>
<html>
<head>
    <title>VibeStream</title>
    <style>
        * { box-sizing: border-box; }
        body { background-color: #000; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 240px; background: #000; padding: 24px; display: flex; flex-direction: column; flex-shrink: 0; border-right: 1px solid #181818; }
        .logo { font-size: 24px; color: #fff; font-weight: bold; margin-bottom: 30px; display: flex; align-items: center; }
        .logo span { color: #1db954; margin-right: 8px; }

        .menu-link { color: #b3b3b3; text-decoration: none; font-weight: 600; padding: 10px 0; display: flex; align-items: center; transition: 0.2s; }
        .menu-link:hover, .menu-link.active { color: #fff; }
        .icon { margin-right: 15px; font-size: 20px; width: 24px; text-align: center; }

        .user-area { margin-top: auto; border-top: 1px solid #282828; padding-top: 20px; }
        .user-btn { display: flex; align-items: center; color: white; text-decoration: none; font-weight: bold; font-size: 14px; }
        .user-avatar { width: 30px; height: 30px; background: #535353; border-radius: 50%; margin-right: 10px; display: flex; justify-content: center; align-items: center; }

        /* MAIN CONTENT */
        .main { flex-grow: 1; padding: 20px 40px; overflow-y: auto; background: linear-gradient(180deg, #1e1e1e 0%, #121212 300px); }
        h1, h2 { letter-spacing: -0.5px; }

        /* CARDS & LISTS */
        .hero { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px; margin-bottom: 20px; }
        .card { background: #181818; padding: 16px; border-radius: 6px; width: 170px; flex-shrink: 0; cursor: pointer; transition: 0.3s; }
        .card:hover { background: #282828; }
        .card-img { width: 100%; aspect-ratio: 1; background: #333; margin-bottom: 15px; border-radius: 4px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .card-title { font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; margin-bottom: 5px; }
        .card-sub { font-size: 13px; color: #b3b3b3; }

        /* TRACK ROW */
        .track-row { display: flex; align-items: center; padding: 10px 15px; border-radius: 5px; transition: 0.2s; }
        .track-row:hover { background: rgba(255,255,255,0.1); }
        .t-img { width: 40px; height: 40px; background: #333; margin-right: 15px; display: flex; justify-content: center; align-items: center; color: #999; border-radius: 4px; }
        .btn-fav { background: transparent; border: 1px solid #777; color: #fff; border-radius: 20px; padding: 5px 15px; cursor: pointer; font-size: 11px; margin-left: auto; }
        .btn-fav.active { background: #1db954; border-color: #1db954; color: #000; font-weight: bold; }

        /* SEARCH BAR */
        .search-container { margin-bottom: 30px; }
        .search-input { width: 100%; max-width: 400px; padding: 14px 20px; border-radius: 50px; border: none; font-size: 16px; color: #000; }

        /* PROFILE GENRES */
        .genres-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        .genre-box input { display: none; }
        .genre-box label { display: block; padding: 15px; background: #282828; border-radius: 5px; text-align: center; cursor: pointer; border: 2px solid transparent; }
        .genre-box input:checked + label { border-color: #1db954; color: #1db954; font-weight: bold; }
        .btn-save { background: #fff; color: #000; border: none; padding: 12px 30px; border-radius: 30px; font-weight: bold; margin-top: 20px; cursor: pointer; font-size: 14px; }
        .btn-save:hover { transform: scale(1.05); }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><span>‚ö°</span> VibeStream</div>

        <a href="/" class="menu-link <%= page==='home'?'active':'' %>">
            <span class="icon">üè†</span> In√≠cio
        </a>
        <a href="/search" class="menu-link <%= page==='search'?'active':'' %>">
            <span class="icon">üîç</span> Buscar
        </a>
        <a href="/library" class="menu-link <%= page==='library'?'active':'' %>">
            <span class="icon">üìö</span> Sua Biblioteca
        </a>

        <br>
        <a href="/profile" class="menu-link <%= page==='profile'?'active':'' %>">
            <span class="icon">‚öôÔ∏è</span> Configura√ß√µes
        </a>

        <div class="user-area">
            <a href="/profile" class="user-btn">
                <div class="user-avatar"><%= usuario.nome.charAt(0) %></div>
                <%= usuario.nome %>
            </a>
            <a href="/logout" style="color:#b3b3b3; font-size:12px; margin-left: 40px; display:block; margin-top:5px; text-decoration:none;">Sair</a>
        </div>
    </div>

    <div class="main">

        <% if (page === 'home') { %>

            <% if (recomendacoes.length > 0) { %>
                <h2>Tocadas recentemente para <%= usuario.nome %></h2>
                <div class="hero">
                    <% recomendacoes.forEach(m => { %>
                        <div class="card">
                            <div class="card-img" style="background: <%= m.genero == 'Rock' ? '#e91e63' : (m.genero == 'Sertanejo' ? '#ff9800' : '#2196f3') %>"></div>
                            <span class="card-title"><%= m.titulo %></span>
                            <span class="card-sub"><%= m.artista %></span>
                            <form action="/favoritar/<%= m._id %>?return=/" method="POST" style="margin-top:8px;">
                                <button class="btn-fav">‚ù§ Tocar</button>
                            </form>
                        </div>
                    <% }) %>
                </div>
            <% } %>

            <h2>Top M√∫sicas</h2>
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <% musicas.forEach((m, i) => { %>
                    <div class="track-row">
                        <span style="width:30px; color:#aaa; font-size:14px;"><%= i+1 %></span>
                        <div class="t-img">‚ô´</div>
                        <div style="flex-grow:1;">
                            <strong style="display:block"><%= m.titulo %></strong>
                            <span style="color:#aaa; font-size:12px;"><%= m.artista %> ‚Ä¢ <%= m.album %></span>
                        </div>
                        <span style="margin-right:20px; font-size:12px; color:#777"><%= m.genero %></span>
                        <form action="/favoritar/<%= m._id %>?return=/" method="POST">
                            <button class="btn-fav <%= usuario.favoritas.includes(m._id.toString()) ? 'active' : '' %>">
                                <%= usuario.favoritas.includes(m._id.toString()) ? 'Salvo' : 'Salvar' %>
                            </button>
                        </form>
                    </div>
                <% }) %>
            </div>
        <% } %>

        <% if (page === 'search') { %>
            <h1>Buscar</h1>
            <div class="search-container">
                <form action="/search" method="GET">
                    <input type="text" name="q" class="search-input" placeholder="O que voc√™ quer ouvir?" value="<%= locals.query || '' %>" autofocus>
                </form>
            </div>

            <% if (locals.resultados) { %>
                <% if (resultados.length > 0) { %>
                    <h2>Resultados para "<%= query %>"</h2>
                    <% resultados.forEach(m => { %>
                        <div class="track-row">
                            <div class="t-img">‚ô´</div>
                            <div style="flex-grow:1;">
                                <strong><%= m.titulo %></strong>
                                <span style="color:#aaa; display:block; font-size:12px;"><%= m.artista %></span>
                            </div>
                            <form action="/favoritar/<%= m._id %>?return=/search?q=<%= query %>" method="POST">
                                <button class="btn-fav <%= usuario.favoritas.includes(m._id.toString()) ? 'active' : '' %>">‚ù§</button>
                            </form>
                        </div>
                    <% }) %>
                <% } else { %>
                    <p>Nenhum resultado encontrado.</p>
                <% } %>
            <% } else { %>
                <h3>Navegar por tudo</h3>
                <div class="hero" style="flex-wrap: wrap;">
                    <div class="card" style="background:#e91e63; height:100px;"> <h3 style="padding:10px;">Rock</h3> </div>
                    <div class="card" style="background:#ff9800; height:100px;"> <h3 style="padding:10px;">Sertanejo</h3> </div>
                    <div class="card" style="background:#2196f3; height:100px;"> <h3 style="padding:10px;">Pop</h3> </div>
                    <div class="card" style="background:#9c27b0; height:100px;"> <h3 style="padding:10px;">HipHop</h3> </div>
                </div>
            <% } %>
        <% } %>

        <% if (page === 'library') { %>
            <div style="display:flex; align-items:center; gap:20px; margin-bottom:30px;">
                <div style="width:150px; height:150px; background: linear-gradient(135deg, #450af5, #c4efd9); box-shadow:0 10px 30px rgba(0,0,0,0.5);"></div>
                <div>
                    <span style="font-size:12px; font-weight:bold;">PLAYLIST</span>
                    <h1 style="font-size:60px; margin:10px 0;">M√∫sicas Curtidas</h1>
                    <p><%= usuario.nome %> ‚Ä¢ <%= minhasMusicas.length %> m√∫sicas</p>
                </div>
            </div>

            <% if (minhasMusicas.length > 0) { %>
                <% minhasMusicas.forEach((m, i) => { %>
                    <div class="track-row">
                        <span style="width:30px; color:#aaa;"><%= i+1 %></span>
                        <div class="t-img">‚ô´</div>
                        <div style="flex-grow:1;">
                            <strong style="color:#1db954"><%= m.titulo %></strong>
                            <span style="color:#aaa; display:block; font-size:12px;"><%= m.artista %></span>
                        </div>
                        <span style="margin-right:20px; color:#aaa; font-size:12px;"><%= m.duracao %></span>
                        <form action="/favoritar/<%= m._id %>?return=/library" method="POST">
                            <button class="btn-fav active">Remover</button>
                        </form>
                    </div>
                <% }) %>
            <% } else { %>
                <p>Voc√™ ainda n√£o curtiu nenhuma m√∫sica. V√° para o In√≠cio e d√™ uns likes!</p>
            <% } %>
        <% } %>

        <% if (page === 'profile') { %>
            <h1>Editar Perfil</h1>
            <div style="background:#181818; padding:30px; border-radius:8px; max-width:600px;">
                <h3>Ol√°, <%= usuario.nome %></h3>
                <p style="color:#aaa">Aqui voc√™ pode alterar seu gosto musical. Isso vai mudar as recomenda√ß√µes na p√°gina inicial.</p>

                <form action="/update-genres" method="POST">
                    <label style="font-size:12px; font-weight:bold; letter-spacing:1px; text-transform:uppercase; color:#b3b3b3;">Seus G√™neros Favoritos</label>

                    <div class="genres-grid">
                        <% ['Rock', 'Sertanejo', 'Pop', 'HipHop', 'Eletronica', 'Indie'].forEach(g => { %>
                            <div class="genre-box">
                                <input type="checkbox" id="g-<%= g %>" name="generos" value="<%= g %>"
                                    <%= usuario.generosPreferidos.includes(g) ? 'checked' : '' %>>
                                <label for="g-<%= g %>"><%= g %></label>
                            </div>
                        <% }) %>
                    </div>

                    <button type="submit" class="btn-save">Salvar Altera√ß√µes</button>
                </form>
            </div>
        <% } %>

    </div>
</body>
</html>
